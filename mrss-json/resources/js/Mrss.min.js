this.akamai=this.akamai||{},this.akamai.amp=this.akamai.amp||{},this.akamai.amp.mrss=function(e){"use strict";var t={CHANGED:"changed",ERROR:"error",REQUEST:"request",LOADED:"loaded"},a=function(e){function t(a,r,i){return babelHelpers.classCallCheck(this,t),e.call(this,a,r,metadta)||this}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,null,[{key:"create",value:function(e,a,r){return new t(e,a)}}]),t}(akamai.amp.AMPError),r=akamai.amp.Media,i=akamai.amp.Utils,s=babelHelpers.createClass(function e(){babelHelpers.classCallCheck(this,e),this.item=[],this.metadata={},this.title=null,this.link=null,this.description=null,this.category=null,this.pubDate=null,this.language=null,this.ttl=null}),n=function(){function e(t){babelHelpers.classCallCheck(this,e),this.logger=t}return babelHelpers.createClass(e,[{key:"getFeed",value:function(e){return i.request(e).then(function(e){return"document"===e.responseType||/^</.test(e.responseText)?i.xmlToJson(e.responseXML):JSON.parse(e.responseText)})}},{key:"getMediaNode",value:function(e,t){var a,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i="media-".concat(t),s=e["media-group"]||e,n=s["media-content"];return n&&null!=n[i]?a=n[i]:null!=s[i]?a=s[i]:null!=e[i]?a=e[i]:null!=e[t]&&r&&(a=e[t]),a}},{key:"createEmbed",value:function(e){try{var t=this.getMediaNode(e,"embed");if(null==t)return;var a={url:t["@attributes"].url,width:t["@attributes"].width,height:t["@attributes"].height,params:{}},r=t["media-param"]instanceof Array?t["media-param"]:[t["media-param"]];return r.forEach(function(e){e&&e["@attributes"]&&e["@attributes"].name&&(a.params[e["@attributes"].name]=e["#text"])}),a}catch(e){this.logger.error("[AMP Feed Parse Error] embed parse error: ".concat(e.message),e)}}},{key:"createFeed",value:function(e){var t=this;try{var a=e.channel,r=new s;if(null!=a){r.title=a.title,r.description=a.description,r.language=a.language,r.category=a.category,r.pubDate=new Date(Date.parse(a.pubDate)),r.ttl=a.ttl;var i=a.item instanceof Array?a.item:[a.item];i.forEach(function(e){var a=t.createMedia(e);r.item.push(a)});for(var n in a)n in r||(r.metadata[n]=a[n])}return r}catch(e){this.logger.error("[AMP Feed Parse Error] feed parse error: ".concat(e.message),e)}}},{key:"createMedia",value:function(e){try{var t=new r,a=this.getMediaNode(e,"content");a instanceof Array?(t.source=[],a.forEach(function(e){var a={src:e["@attributes"].url,type:e["@attributes"].type},r=e["media-category"];if(null!=r){var i=r["@attributes"];if("http://mrss.akamai.com/user_agent_hint"===i.schema){var s=i.label||r["#text"];s&&(null==a.rules&&(a.rules=[]),a.rules.push(s))}}t.source.push(a),t.medium=e["@attributes"].medium,t.duration=parseFloat(e["@attributes"].duration)})):(t.type=a["@attributes"].type,t.src=a["@attributes"].url,t.medium=a["@attributes"].medium,t.duration=parseFloat(a["@attributes"].duration)),t.guid=e.guid,t.title=this.getMediaNode(e,"title"),t.link=e.link,t.description=this.getMediaNode(e,"description"),t.pubDate=new Date(Date.parse(e.pubDate));var i,s;t.thumbnail=t.poster=null!=(i=this.getMediaNode(e,"thumbnail"))&&null!=(s=i["@attributes"])?s.url:void 0,t.embed=this.createEmbed(e);var n=this.getMediaNode(e,"scenes")||{};t.scenes=n["media-scene"];var l=this.getMediaNode(e,"status",!1);null!=l&&(t.status={state:l["@attributes"].state,reason:l["@attributes"].reason}),l=this.getMediaNode(e,"restriction",!1),null!=l&&(l instanceof Array||(l=[l]),t.restriction=[],l.forEach(function(e){t.restriction.push({relationship:e["@attributes"].relationship,type:e["@attributes"].type,value:e["#text"].split(" ")})})),t.category=e.category,t.category instanceof Array||(t.category=[t.category]),l=this.getMediaNode(e,"category",!1),null!=l&&(l instanceof Array||(l=[l]),l.forEach(function(e){e["#text"]&&t.category.push(e["#text"])})),null!=t.category&&t.category.sort(function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e>t?1:e<t?-1:0}),l=this.getMediaNode(e,"subTitle"),null!=l&&(null==t.track&&(t.track=[]),l instanceof Array||(l=[l]),l.forEach(function(e){null!=e["@attributes"]&&t.track.push({src:e["@attributes"].href,type:e["@attributes"].type,kind:"captions",srclang:e["@attributes"].lang||"en"})}));var u=e.category;u instanceof Array||(u=[u]),t.isLive="live"===e.temporalType||null!=u&&u.join(",").indexOf("live_stream")!==-1,t.temporalType=t.isLive?"live":e.temporalType||"vod";for(var o in e)o in t||(t.metadata[o]=e[o]);return t}catch(e){this.logger.error("[AMP Feed Parse Error] media parse error: ".concat(e.message),e)}}}]),e}(),l=function(e){function r(t,a){var i;return babelHelpers.classCallCheck(this,r),i=e.call(this,t,a)||this,i.feature="feed",i.helper=new n(i.logger),i.mediaTransform=i.mediaTransform.bind(babelHelpers.assertThisInitialized(i)),i}return babelHelpers.inherits(r,e),babelHelpers.createClass(r,[{key:"data",get:function(){return this._data},set:function(e){this.player.media=this._setData(e)}},{key:"url",get:function(){return this._url},set:function(e){var t=this;this._setUrl(e).then(function(e){return t.data=e})}},{key:"_setUrl",value:function(e){var a=this;return this._url=this.player.evaluatePaths(e),this.dispatch(t.REQUEST,this._url),this.helper.getFeed(this._url).then(function(e){return a.dispatch(t.LOADED,e),e}).catch(function(r){a.dispatch(t.ERROR,{error:r,url:e}),a.logger.error("[AMP Feed Load Error]",a._url,r)})}},{key:"_setData",value:function(e){return this._data=e,this.feed=this.helper.createFeed(e),this.dispatch(t.CHANGED,this.feed),this.feed.item[0]}},{key:"mediaTransform",value:function(e){var t=this,a=akamai.amp.Utils,r=a.mimeTypes,i=e.type||a.getMimeType(e.src);return i!=r.xml&&i!=r.json&&void 0!=i?e:Promise.resolve(e.src).then(function(e){return"string"==typeof e?t._setUrl(e):e}).then(function(e){return t._setData(e)})}},{key:"onready",value:function(){var e=this,t=this.config.url,r=this.config.data,i=null,s=this.config.transform;if((t||r)&&null!=this.player.config.media)throw a.create("Duplicate media items in player config");return t||r||s||(s=!0),s?void this.player.addTransform(akamai.amp.TransformType.MEDIA,this.mediaTransform):(null!=t&&""!=t?i=function(){return e.url=t}:null!=r&&(i=function(){return e.data=r}),void("function"==typeof i&&this.player.timers.setTimeout(i,1)))}}]),r}(akamai.amp.Plugin);return akamai.amp.AMP.registerPlugin("mrss",akamai.amp.Plugin.createFactory(l)),e.MRSS=l,e.MRSSEvents=t,Object.defineProperty(e,"__esModule",{value:!0}),e}({});